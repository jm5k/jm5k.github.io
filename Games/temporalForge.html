<!DOCTYPE html>
<html lang="en" data-theme="technolust">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <title>Temporal Forge | Linear Clock Lab</title>
    <meta
      name="description"
      content="Temporal Forge — an idle time-smelting game for Linear Clock Lab. Turn real-world seconds into Time Ore, Alloys, and Chrono Bars with upgrades and automation."
    />
    <meta
      name="keywords"
      content="idle game, incremental game, temporal forge, time smelter, linear clock lab, jm5k"
    />
    <meta name="author" content="jm5k" />
    <meta name="robots" content="index, follow" />

    <style>
      :root {
        --bg: #000;
        --fg: #e0e0e0;
        --muted: #9aa0aa;
        --accent: #00ffff;
        --accent-soft: rgba(0, 255, 255, 0.15);
        --rail: #111;
        --rail-border: #333;
        --card: #05060a;
        --card-border: #222;
        --danger: #ff4f4f;
        --success: #7bff7b;
        --shadow-soft: 0 0 30px rgba(0, 255, 255, 0.15);
        --radius-lg: 14px;
        --radius-sm: 8px;
        --transition-fast: 0.15s ease-out;
        --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: radial-gradient(
          circle at top,
          #050815 0,
          #000 40%,
          #000 100%
        );
        color: var(--fg);
        font-family: var(--font-main);
        display: flex;
        flex-direction: column;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      header {
        padding: 16px 6vw 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      header .title-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      header h1 {
        font-size: 1.4rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        margin: 0;
      }

      header p {
        margin: 0;
        font-size: 0.85rem;
        color: var(--muted);
      }

      .nav-link {
        font-size: 0.8rem;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--accent);
        background: rgba(0, 0, 0, 0.6);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        box-shadow: 0 0 12px rgba(0, 255, 255, 0.2);
      }

      .nav-link span {
        font-size: 0.9rem;
      }

      main {
        padding: 0 6vw 24px;
        max-width: 1200px;
        width: 100%;
        margin: 0 auto 16px;
      }

      /* 24-hour rail */
      .day-rail {
        margin: 4px 0 20px;
        padding: 10px 0 12px;
      }

      .rail-label {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .rail-track {
        position: relative;
        height: 12px;
        border-radius: 999px;
        background: var(--rail);
        border: 1px solid var(--rail-border);
        overflow: hidden;
        box-shadow: var(--shadow-soft);
      }

      .rail-fill {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          rgba(0, 255, 255, 0.2),
          rgba(0, 255, 255, 0.9),
          rgba(0, 255, 255, 0.2)
        );
        transform-origin: left center;
        transform: scaleX(0);
        transition: transform 0.4s ease-out;
      }

      .rail-marker {
        position: absolute;
        top: 50%;
        width: 3px;
        height: 22px;
        background: var(--accent);
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.9);
        transform: translate(-50%, -50%);
      }

      .rail-meta {
        margin-top: 4px;
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: var(--muted);
      }

      /* Layout */
      .grid {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
        gap: 18px;
      }

      @media (max-width: 900px) {
        .grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        background: linear-gradient(
          145deg,
          #05060a 0,
          #050816 60%,
          #05060a 100%
        );
        border-radius: var(--radius-lg);
        padding: 14px 16px 16px;
        border: 1px solid var(--card-border);
        box-shadow: 0 0 18px rgba(0, 0, 0, 0.7);
      }

      .card h2 {
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--muted);
        margin: 0 0 10px;
      }

      .card small {
        font-size: 0.75rem;
        color: var(--muted);
      }

      .resources {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px;
        margin-bottom: 10px;
      }

      @media (max-width: 600px) {
        .resources {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .res-pill {
        border-radius: var(--radius-sm);
        border: 1px solid var(--card-border);
        padding: 8px 9px;
        background: radial-gradient(circle at top left, #0a1018, #05060a);
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .res-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        color: var(--muted);
      }

      .res-label span.key {
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .res-label span.badge {
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(0, 255, 255, 0.4);
        color: var(--accent);
        font-size: 0.7rem;
      }

      .res-value {
        font-size: 1.05rem;
        font-variant-numeric: tabular-nums;
      }

      .res-value strong {
        color: var(--accent);
      }

      .res-rate {
        font-size: 0.7rem;
        color: var(--muted);
      }

      .btn-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 6px 0 4px;
      }

      button {
        cursor: pointer;
        border-radius: 999px;
        border: 1px solid var(--card-border);
        background: rgba(0, 0, 0, 0.6);
        color: var(--fg);
        padding: 6px 11px;
        font-size: 0.8rem;
        font-family: inherit;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background var(--transition-fast),
          border-color var(--transition-fast), transform var(--transition-fast),
          box-shadow var(--transition-fast), opacity var(--transition-fast);
      }

      button span.hotkey {
        opacity: 0.7;
        font-size: 0.7rem;
      }

      button.primary {
        border-color: rgba(0, 255, 255, 0.8);
        box-shadow: 0 0 14px rgba(0, 255, 255, 0.25);
      }

      button.primary:hover:not(:disabled) {
        background: linear-gradient(90deg, #041f24, #062a32);
        transform: translateY(-1px);
      }

      button.secondary:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.06);
        transform: translateY(-1px);
      }

      button:disabled {
        opacity: 0.4;
        cursor: default;
        box-shadow: none;
      }

      .smelt-log {
        margin-top: 8px;
        padding-top: 6px;
        border-top: 1px dashed rgba(120, 130, 140, 0.5);
        font-size: 0.72rem;
        color: var(--muted);
        max-height: 72px;
        overflow: hidden;
      }

      .smelt-log-line {
        opacity: 0.8;
      }

      .smelt-log-line + .smelt-log-line {
        margin-top: 2px;
      }

      .smelt-log-line span.highlight {
        color: var(--accent);
      }

      .smelt-log-line span.success {
        color: var(--success);
      }

      .smelt-log-line span.danger {
        color: var(--danger);
      }

      /* Upgrades */
      .upgrades-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 4px;
      }

      .upgrade {
        border-radius: var(--radius-sm);
        border: 1px solid var(--card-border);
        padding: 7px 9px;
        display: grid;
        grid-template-columns: minmax(0, 1.4fr) auto;
        gap: 6px;
        background: radial-gradient(circle at top left, #070b10, #05060a);
      }

      .upgrade-header {
        font-size: 0.82rem;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .upgrade-header strong {
        letter-spacing: 0.06em;
        text-transform: uppercase;
        font-size: 0.76rem;
        color: var(--accent);
      }

      .upgrade-header span.desc {
        color: var(--muted);
        font-size: 0.75rem;
      }

      .upgrade-meta {
        font-size: 0.7rem;
        color: var(--muted);
      }

      .upgrade-meta span.cost {
        color: var(--accent);
      }

      .upgrade-meta span.level {
        color: var(--success);
      }

      .upgrade-actions {
        display: flex;
        align-items: center;
        justify-content: flex-end;
      }

      /* Footer */
      footer {
        padding: 10px 6vw 14px;
        border-top: 1px solid #111;
        font-size: 0.75rem;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .save-status {
        font-size: 0.72rem;
        opacity: 0.8;
      }

      .save-status span {
        color: var(--accent);
      }

      .danger-link {
        color: var(--danger);
        cursor: pointer;
        text-decoration: underline;
      }

      @media (max-width: 600px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }

        footer {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title-block">
        <h1>Temporal Forge</h1>
        <p>Smelt real-world seconds into alloys and chrono bars.</p>
      </div>
      <a class="nav-link" href="index.html">
        <span>←</span>
        <span>Back to Linear Clock Lab</span>
      </a>
    </header>

    <main>
      <!-- Day Rail -->
      <section class="day-rail">
        <div class="rail-label">
          <span>24-Hour Continuum</span>
          <span id="rail-time-label">--:--:--</span>
        </div>
        <div class="rail-track">
          <div class="rail-fill" id="rail-fill"></div>
          <div class="rail-marker" id="rail-marker" style="left: 0%"></div>
        </div>
        <div class="rail-meta">
          <span id="rail-day-percent">Day progress: --%</span>
          <span id="rail-remaining">Remaining: --:--:--</span>
        </div>
      </section>

      <section class="grid">
        <!-- LEFT: Resources & Actions -->
        <section class="card">
          <h2>Smelter Core</h2>
          <small
            >Time flows even when this tab is in the background. Your forge
            catches up when you return.</small
          >

          <div class="resources" id="resources">
            <div class="res-pill">
              <div class="res-label">
                <span class="key">Time Ore</span>
                <span class="badge">Base Resource</span>
              </div>
              <div class="res-value">
                <strong id="ore-count">0</strong>
              </div>
              <div class="res-rate">
                Generation: <span id="ore-rate">0 /s</span>
              </div>
            </div>

            <div class="res-pill">
              <div class="res-label">
                <span class="key">Alloys</span>
                <span class="badge">Refined</span>
              </div>
              <div class="res-value">
                <strong id="alloy-count">0</strong>
              </div>
              <div class="res-rate">
                Auto Smelt: <span id="alloy-rate">0 /s</span>
              </div>
            </div>

            <div class="res-pill">
              <div class="res-label">
                <span class="key">Chrono Bars</span>
                <span class="badge">Prime Output</span>
              </div>
              <div class="res-value">
                <strong id="bar-count">0</strong>
              </div>
              <div class="res-rate">
                Forge Power: <span id="bar-mult">x1.0</span>
              </div>
            </div>
          </div>

          <div class="btn-row">
            <button id="btn-smelt" class="primary">
              Smelt 25 Ore → 1 Alloy <span class="hotkey">(S)</span>
            </button>
            <button id="btn-forge" class="secondary">
              Forge 5 Alloys → Bars <span class="hotkey">(F)</span>
            </button>
          </div>

          <div class="smelt-log" id="log">
            <div class="smelt-log-line">
              Forge initialized. <span class="highlight">Time Ore</span> will
              accumulate as long as this save exists.
            </div>
          </div>
        </section>

        <!-- RIGHT: Upgrades -->
        <section class="card">
          <h2>Upgrades</h2>
          <small
            >Invest your resources to bend time production in your favor.</small
          >

          <div class="upgrades-list" id="upgrades-list">
            <article class="upgrade" data-upgrade-id="hotterFurnace">
              <div>
                <div class="upgrade-header">
                  <strong>Hotter Furnace</strong>
                  <span class="desc"
                    >Boosts Time Ore generation per second.</span
                  >
                </div>
                <div class="upgrade-meta">
                  Cost: <span class="cost" data-cost-label>50 Time Ore</span> ·
                  Level: <span class="level" data-level-label>0</span>
                </div>
              </div>
              <div class="upgrade-actions">
                <button class="primary" data-upgrade-button>Upgrade</button>
              </div>
            </article>

            <article class="upgrade" data-upgrade-id="autoSmelter">
              <div>
                <div class="upgrade-header">
                  <strong>Auto Smelter</strong>
                  <span class="desc"
                    >Automatically smelts Ore into Alloys over time.</span
                  >
                </div>
                <div class="upgrade-meta">
                  Cost: <span class="cost" data-cost-label>5 Alloys</span> ·
                  Level: <span class="level" data-level-label>0</span>
                </div>
              </div>
              <div class="upgrade-actions">
                <button class="secondary" data-upgrade-button>Upgrade</button>
              </div>
            </article>

            <article class="upgrade" data-upgrade-id="efficientForge">
              <div>
                <div class="upgrade-header">
                  <strong>Efficient Forge</strong>
                  <span class="desc"
                    >Each forge action creates more Chrono Bars.</span
                  >
                </div>
                <div class="upgrade-meta">
                  Cost: <span class="cost" data-cost-label>10 Alloys</span> ·
                  Level: <span class="level" data-level-label>0</span>
                </div>
              </div>
              <div class="upgrade-actions">
                <button class="secondary" data-upgrade-button>Upgrade</button>
              </div>
            </article>
          </div>
        </section>
      </section>
    </main>

    <footer>
      <div class="save-status" id="save-status">Save: <span>Ready</span></div>
      <div>
        <span
          >© jm5k 2025 — Temporal Forge, a Linear Clock Lab experiment.</span
        >
        &nbsp;·&nbsp;
        <span class="danger-link" id="reset-save">Reset Forge</span>
      </div>
    </footer>

    <script>
      (function () {
        const SAVE_KEY = "TemporalForgeSave_v1";

        const oreEl = document.getElementById("ore-count");
        const alloyEl = document.getElementById("alloy-count");
        const barEl = document.getElementById("bar-count");
        const oreRateEl = document.getElementById("ore-rate");
        const alloyRateEl = document.getElementById("alloy-rate");
        const barMultEl = document.getElementById("bar-mult");
        const logEl = document.getElementById("log");
        const saveStatusEl = document.getElementById("save-status");

        const btnSmelt = document.getElementById("btn-smelt");
        const btnForge = document.getElementById("btn-forge");
        const resetBtn = document.getElementById("reset-save");

        const railFill = document.getElementById("rail-fill");
        const railMarker = document.getElementById("rail-marker");
        const railTimeLabel = document.getElementById("rail-time-label");
        const railDayPercent = document.getElementById("rail-day-percent");
        const railRemaining = document.getElementById("rail-remaining");

        const upgradesListEl = document.getElementById("upgrades-list");

        let state = {
          ore: 0,
          alloys: 0,
          bars: 0,
          orePerSecondBase: 1,
          orePerSecondBonus: 0,
          autoSmeltRate: 0,
          forgeMultiplier: 1,
          upgrades: {
            hotterFurnace: 0,
            autoSmelter: 0,
            efficientForge: 0,
          },
          lastUpdate: Date.now(),
        };

        const upgradeDefs = {
          hotterFurnace: {
            baseCost: 50,
            costScale: 1.65,
            currency: "ore",
            bonusPerLevel: 0.4,
            label: "Time Ore",
          },
          autoSmelter: {
            baseCost: 5,
            costScale: 2,
            currency: "alloys",
            bonusPerLevel: 0.2,
            label: "Alloys",
          },
          efficientForge: {
            baseCost: 10,
            costScale: 2.1,
            currency: "alloys",
            bonusPerLevel: 0.3,
            label: "Alloys",
          },
        };

        function formatNumber(value) {
          if (value < 1000) return value.toFixed(0);
          if (value < 1000000)
            return value.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
          return value.toExponential(2);
        }

        function formatTime(h, m, s) {
          const pad = (n) => String(n).padStart(2, "0");
          return pad(h) + ":" + pad(m) + ":" + pad(s);
        }

        function appendLog(messageHtml) {
          const line = document.createElement("div");
          line.className = "smelt-log-line";
          line.innerHTML = messageHtml;
          logEl.insertBefore(line, logEl.firstChild);
          while (logEl.children.length > 5) {
            logEl.removeChild(logEl.lastChild);
          }
        }

        function saveState() {
          try {
            const data = { ...state, lastUpdate: Date.now() };
            localStorage.setItem(SAVE_KEY, JSON.stringify(data));
            saveStatusEl.innerHTML = "Save: <span>OK</span>";
          } catch (e) {
            console.error("Save error", e);
            saveStatusEl.innerHTML =
              'Save: <span style="color:#ff4f4f">Error</span>';
          }
        }

        function loadState() {
          try {
            const raw = localStorage.getItem(SAVE_KEY);
            if (!raw) {
              state.lastUpdate = Date.now();
              return;
            }
            const data = JSON.parse(raw);
            state = {
              ...state,
              ...data,
              upgrades: { ...state.upgrades, ...(data.upgrades || {}) },
            };
            appendLog(
              `<span class="success">Loaded existing forge state.</span> You kept earning <span class="highlight">Time Ore</span> since your last visit.`
            );
          } catch (e) {
            console.error("Load error", e);
            appendLog(
              `<span class="danger">Save data corrupted.</span> A fresh forge has been initialized.`
            );
          } finally {
            state.lastUpdate = Date.now();
          }
        }

        function resetState() {
          localStorage.removeItem(SAVE_KEY);
          state = {
            ore: 0,
            alloys: 0,
            bars: 0,
            orePerSecondBase: 1,
            orePerSecondBonus: 0,
            autoSmeltRate: 0,
            forgeMultiplier: 1,
            upgrades: {
              hotterFurnace: 0,
              autoSmelter: 0,
              efficientForge: 0,
            },
            lastUpdate: Date.now(),
          };
          appendLog(
            `<span class="danger">Forge reset.</span> All resources and upgrades cleared.`
          );
          updateUI();
          saveState();
        }

        function computeDayRail() {
          const now = new Date();
          const h = now.getHours();
          const m = now.getMinutes();
          const s = now.getSeconds();

          const secondsToday = h * 3600 + m * 60 + s;
          const total = 24 * 3600;
          const ratio = secondsToday / total;
          const percent = ratio * 100;

          railFill.style.transform = `scaleX(${ratio})`;
          railMarker.style.left = `${percent}%`;

          railTimeLabel.textContent = formatTime(h, m, s);
          railDayPercent.textContent =
            "Day progress: " + percent.toFixed(1) + "%";

          const remaining = total - secondsToday;
          const rh = Math.floor(remaining / 3600);
          const rm = Math.floor((remaining % 3600) / 60);
          const rs = remaining % 60;

          railRemaining.textContent = "Remaining: " + formatTime(rh, rm, rs);
        }

        function updateUpgradesUI() {
          const upgradeEls = upgradesListEl.querySelectorAll(".upgrade");
          upgradeEls.forEach((el) => {
            const id = el.getAttribute("data-upgrade-id");
            const def = upgradeDefs[id];
            const level = state.upgrades[id] || 0;

            const cost = Math.round(
              def.baseCost * Math.pow(def.costScale, level)
            );

            const costLabel = el.querySelector("[data-cost-label]");
            const levelLabel = el.querySelector("[data-level-label]");
            const button = el.querySelector("[data-upgrade-button]");

            costLabel.textContent = `${cost} ${def.label}`;
            levelLabel.textContent = level;

            let affordable = false;
            if (def.currency === "ore") {
              affordable = state.ore >= cost;
            } else if (def.currency === "alloys") {
              affordable = state.alloys >= cost;
            }

            button.disabled = !affordable;
          });

          const orePerSec = state.orePerSecondBase + state.orePerSecondBonus;
          oreRateEl.textContent = orePerSec.toFixed(2) + " /s";
          alloyRateEl.textContent = state.autoSmeltRate.toFixed(2) + " /s";
          barMultEl.textContent = "x" + state.forgeMultiplier.toFixed(1);
        }

        function updateUI() {
          oreEl.textContent = formatNumber(state.ore);
          alloyEl.textContent = formatNumber(state.alloys);
          barEl.textContent = formatNumber(state.bars);
          updateUpgradesUI();
        }

        function processTick(deltaSeconds) {
          const orePerSec = state.orePerSecondBase + state.orePerSecondBonus;
          const oreGain = orePerSec * deltaSeconds;
          state.ore += oreGain;

          if (state.autoSmeltRate > 0 && state.ore > 0) {
            const potentialAlloys = state.autoSmeltRate * deltaSeconds;
            const orePerAlloy = 25;
            const maxByOre = state.ore / orePerAlloy;
            const alloysProduced = Math.min(potentialAlloys, maxByOre);
            if (alloysProduced > 0) {
              state.ore -= alloysProduced * orePerAlloy;
              state.alloys += alloysProduced;
            }
          }
        }

        function gameLoop() {
          const now = Date.now();
          const deltaMs = now - state.lastUpdate;
          state.lastUpdate = now;

          const deltaSeconds = Math.max(0, deltaMs / 1000);
          if (deltaSeconds > 0) {
            processTick(deltaSeconds);
            updateUI();
          }

          computeDayRail();
          requestAnimationFrame(gameLoop);
        }

        function smeltOre() {
          const orePerAlloy = 25;
          if (state.ore < orePerAlloy) {
            appendLog(
              `<span class="danger">Not enough Ore</span> — need 25 Time Ore to smelt.`
            );
            return;
          }
          state.ore -= orePerAlloy;
          state.alloys += 1;
          appendLog(
            `Manual smelt: <span class="highlight">25</span> Ore → <span class="success">1 Alloy</span>.`
          );
          updateUI();
          saveState();
        }

        function forgeBars() {
          const alloysPerForge = 5;
          if (state.alloys < alloysPerForge) {
            appendLog(
              `<span class="danger">Not enough Alloys</span> — need 5 Alloys to forge.`
            );
            return;
          }
          state.alloys -= alloysPerForge;
          const baseBars = 1;
          const barsGained = baseBars * state.forgeMultiplier;
          state.bars += barsGained;
          appendLog(
            `Forge action: <span class="highlight">5</span> Alloys → <span class="success">${barsGained.toFixed(
              1
            )} Chrono Bars</span>.`
          );
          updateUI();
          saveState();
        }

        function purchaseUpgrade(id) {
          const def = upgradeDefs[id];
          const level = state.upgrades[id] || 0;
          const cost = Math.round(
            def.baseCost * Math.pow(def.costScale, level)
          );

          if (def.currency === "ore") {
            if (state.ore < cost) return;
            state.ore -= cost;
          } else if (def.currency === "alloys") {
            if (state.alloys < cost) return;
            state.alloys -= cost;
          }

          state.upgrades[id] = level + 1;

          if (id === "hotterFurnace") {
            state.orePerSecondBonus += def.bonusPerLevel;
            appendLog(
              `Upgrade: <span class="success">Hotter Furnace</span> → Ore rate boosted by <span class="highlight">${def.bonusPerLevel.toFixed(
                2
              )}/s</span>.`
            );
          } else if (id === "autoSmelter") {
            state.autoSmeltRate += def.bonusPerLevel;
            appendLog(
              `Upgrade: <span class="success">Auto Smelter</span> → Auto smelt boosted by <span class="highlight">${def.bonusPerLevel.toFixed(
                2
              )}/s</span>.`
            );
          } else if (id === "efficientForge") {
            state.forgeMultiplier += def.bonusPerLevel;
            appendLog(
              `Upgrade: <span class="success">Efficient Forge</span> → Forge multiplier increased by <span class="highlight">${def.bonusPerLevel.toFixed(
                1
              )}x</span>.`
            );
          }

          updateUI();
          saveState();
        }

        btnSmelt.addEventListener("click", smeltOre);
        btnForge.addEventListener("click", forgeBars);

        document.addEventListener("keydown", (e) => {
          if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")
            return;
          if (e.key === "s" || e.key === "S") {
            e.preventDefault();
            smeltOre();
          } else if (e.key === "f" || e.key === "F") {
            e.preventDefault();
            forgeBars();
          }
        });

        upgradesListEl.addEventListener("click", (e) => {
          const btn = e.target.closest("[data-upgrade-button]");
          if (!btn) return;
          const upgradeEl = btn.closest(".upgrade");
          if (!upgradeEl) return;
          const id = upgradeEl.getAttribute("data-upgrade-id");
          purchaseUpgrade(id);
        });

        resetBtn.addEventListener("click", () => {
          if (
            confirm(
              "Reset Temporal Forge? This clears all Ore, Alloys, Bars, and upgrades."
            )
          ) {
            resetState();
          }
        });

        window.addEventListener("beforeunload", saveState);

        loadState();
        updateUI();
        computeDayRail();
        saveStatusEl.innerHTML = "Save: <span>Ready</span>";
        requestAnimationFrame(gameLoop);
      })();
    </script>
  </body>
</html>
